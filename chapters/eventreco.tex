
\chapter{Mu2e Offline Event Reconstruction}\label{trackreco}

The central objective of the Mu2e reconstruction algorithms is to achieve efficient 
reconstruction of electrons in the range of conversion electrons. To fulfill this objective, 
the algorithms and a few user-defined parameters within them are set to default values optimized 
specifically for this scenario. This section outlines the stages of a Mu2e event reconstruction.

\section{Tracker Hit Reconstruction and Pre-filtering}

The Mu2e reconstruction process starts with hit reconstruction, where digital signals from the 
tracker are converted into physical time and position, creating StrawHits. Adjacent StrawHits in 
a panel, likely from the same particle, are combined into ComboHits to facilitate pattern recognition. 
The FlgBkgHits algorithm flags hits from low-energy electrons or positrons due to scattering, $\gamma$ 
conversion, or $\delta$-rays. This algorithm clusters hits in time and in the $xy$ plane, using 
Multivariate Analysis to distinguish low-energy hits from conversion electron hits, which are stored for subsequent pattern recognition.

\section{Calorimeter Hit Reconstruction}

CaloClusters are formed by combining signals from crystals hit by particles 
in the calorimeter. Clusters are reconstructed by grouping adjacent crystals 
within a 2 ns window and an adjustable energy threshold, currently set at 50 MeV.

\section{Helix Search}

Charged particles in the DS magnetic field follow helical trajectories described 
by the following parameters:

\[
\vec{\eta} \equiv (d_0, \phi_0, \omega, z_0, \tan \lambda);
\]

where $d_0$ is the distance of the point of closest approach to the solenoid axis, 
signed by the particle angular momentum with respect to the origin; $\phi_0$ is 
defined by the momentum direction at the point of closest approach; $\omega = 1/R$ 
is the curvature in the transverse plane; $z_0$ is the $z$-coordinate of the point of 
closest approach; $90^\circ - \lambda$ is the pitch angle between the momentum $p$ and 
the $xy$ plane. Helix search involves time clustering and pattern recognition.

\subsubsection{Time Clustering}

The Time Clustering algorithm groups hits within a narrow time window into TimeClusters. 
Since ComboHits from the same particle tend to cluster in time, for each group of ComboHits a 
TimeCluster is created. To improve the clustering, the time distribution is generated by 
propagating all the hit times to the central plane of the tracker ($z=0$). Finally, the 
TimeCluster time and position in the calorimeter are evaluated. The process is iterated 
until the list of ComboHits associated with the TimeCluster is stable. All TimeClusters with 
more than a programmable number of hits are stored. Pattern recognition follows, utilizing 
information from both tracker and calorimeter through two different algorithms.
\subsubsection{Pattern Recognition}

Pattern recognition in Mu2e can be categorized into two main approaches: 
Tracker-only Pattern Recognition and Calorimeter + Tracker Pattern Recognition.

\paragraph{TrkPatRec: Tracker-only Pattern Recognition}

TrkPatRec performs helix reconstruction in the $xy$ plane and finds the 
track projection on the transverse plane, determining the radius and impact 
parameter with respect to the Stopping Target. It then performs reconstruction 
in the $\phi z$ plane to determine the track pitch. Circle fitting and angular 
position corrections are used for reconstruction.

\paragraph{CalPatRec: Calorimeter + Tracker Pattern Recognition}

CalPatRec employs CaloClusters as initial templates for pattern 
recognition. Assuming the existence of a CaloCluster with reconstructed 
energy above 50 MeV, its time and position are used to filter the collection of 
ComboHits. These hits are expected to lie within the calorimeter acceptance, 
and those within a defined time window around the cluster time are selected. 
Helix fitting is performed using the filtered ComboHits, with track parameters 
iteratively adjusted until convergence is achieved. This combined approach 
enhances track reconstruction efficiency, particularly for electrons in the conversion energy range.

\section{Track Fitting and Momentum Determination}

Once the track candidates have been identified, track fitting algorithms 
are applied to refine the track parameters and estimate the momentum of the 
charged particles. The primary track fitting algorithm used in Mu2e is the Kalman 
Filter, a recursive method that optimally estimates the track parameters by minimizing the chi-squared of the track fit.

The Kalman Filter considers multiple scattering, energy loss, and magnetic 
field variations, making it well-suited for the high-precision tracking 
required in the Mu2e experiment. The momentum resolution achieved is crucial 
for distinguishing conversion electrons from background processes.

\section{Background Rejection and Signal Selection}

Background rejection is a critical aspect of the Mu2e event reconstruction, 
as the experiment aims to detect rare conversion events amidst a significant 
background. Several strategies are employed to enhance signal selection and suppress background events:

\begin{itemize}
    \item \textbf{Timing Cuts:} Events are selected based on their timing relative 
    to the beam structure, reducing beam-related backgrounds.
    \item \textbf{Track Quality Cuts:} Tracks must meet specific quality criteria, 
    such as a minimum number of hits and a maximum chi-squared value, to ensure reliable reconstruction.
    \item \textbf{Calorimeter Matching:} Tracks are matched with CaloClusters based 
    on spatial and temporal criteria to confirm the presence of an electromagnetic 
    shower consistent with a conversion electron.
    \item \textbf{Likelihood-Based Methods:} Multivariate analysis techniques, such 
    as boosted decision trees, are employed to combine various discriminating 
    variables and enhance signal purity.
\end{itemize}

\section{Data Analysis and Event Classification}

After reconstruction and background rejection, the final step in the Mu2e 
simulation framework is data analysis and event classification. This involves 
categorizing events into different classes based on their characteristics and 
analyzing the resulting distributions to extract physics results.

The analysis is performed using ROOT, a powerful data analysis framework that 
provides a wide range of tools for histogramming, fitting, and statistical analysis. 
Custom scripts and macros are developed to automate the analysis process and generate 
plots and tables for interpretation.

\section{Conclusion}

The Mu2e simulation framework is a sophisticated software suite that enables 
comprehensive studies of detector performance, signal reconstruction, and background 
characteristics. By utilizing a combination of multi-stage simulation, advanced 
reconstruction algorithms, and efficient background rejection techniques, the framework 
supports the search for charged lepton flavor violation in the Mu2e experiment. The flexibility 
of the simulation framework allows for thorough investigations of various physics scenarios, 
design optimizations, and detector responses.

Through the integration of state-of-the-art technologies such as GEANT4, \textit{art}, 
and ROOT, the simulation framework provides the necessary tools to achieve the scientific 
goals of the Mu2e collaboration. Ongoing developments and improvements in the framework 
continue to enhance the precision and reliability of the simulation, paving the way for 
groundbreaking discoveries in the field of particle physics.
